{
  "version": 3,
  "sources": ["../../Private/Assets/Fetch.js"],
  "sourcesContent": ["import PhotoSwipeLightbox from \"photoswipe/lightbox\";\n\nconst i18n = JSON.parse(document.querySelector(\"[data-photoswipe-i18n]\")?.dataset?.photoswipeI18n || \"{}\");\nlet optionsFromNeos = JSON.parse(\n    document.querySelector(\"[data-photoswipe-fetch-options]\")?.dataset?.photoswipeFetchOptions || \"{}\",\n);\noptionsFromNeos = { ...i18n, ...optionsFromNeos };\n\nconst wrappingClass = optionsFromNeos.wrappingClass || \"jonnitto-photoswipe-content\";\nconst fetchLinkAppend = optionsFromNeos.fetchLinkAppend || \"\";\ndelete optionsFromNeos.contentSelector;\ndelete optionsFromNeos.fetchLinkAppend;\n\nlet pswpContainer = null;\nlet currentContent = null;\n\nfunction init(options = {}) {\n    options = { ...optionsFromNeos, ...options };\n    const lightbox = new PhotoSwipeLightbox({\n        preloadFirstSlide: false,\n        allowPanToNext: false,\n        initialZoomLevel: 1,\n        secondaryZoomLevel: 1,\n        maxZoomLevel: 1,\n        wheelToZoom: false,\n        closeOnVerticalDrag: false,\n        mainClass: \"pswp--fetch\",\n        arrowKeys: false,\n        preloaderDelay: 1000,\n\n        pswpModule: () => import(\"photoswipe\"),\n        ...options,\n    });\n\n    lightbox.addFilter(\"isContentZoomable\", () => false);\n    lightbox.addFilter(\"preventPointerEvent\", () => true);\n\n    lightbox.on(\"firstUpdate\", (event) => {\n        const container = getPswpContainer();\n        container.setAttribute(\"data-turbo-temporary\", true);\n        // This enables default scrolling\n        container?.addEventListener(\n            \"wheel\",\n            (event) => {\n                event.stopImmediatePropagation();\n                event.stopPropagation();\n            },\n            { passive: true },\n        );\n\n        // Register click handler between slides\n        container?.addEventListener(\"click\", pswpContentEventListener);\n    });\n\n    lightbox.on(\"destroy\", () => {\n        dispatchEvent({ type: \"fetch\", action: \"close\" });\n    });\n\n    lightbox.on(\"contentLoad\", async (event) => {\n        const { content } = event;\n        let src = content?.data?.src;\n        if (content.type != \"fetch\" || !src) {\n            return;\n        }\n        content.state = \"loading\";\n        event.preventDefault();\n        const element = await fetchElement(src);\n        content.element = element;\n        currentContent = content.element;\n        content.onLoaded();\n    });\n    lightbox.init();\n    return lightbox;\n}\n\nasync function pswpContentEventListener(event) {\n    const target = event.target;\n    if (!target.matches('[data-pswp-type=\"fetch\"]')) {\n        return;\n    }\n    event.preventDefault();\n    const newElement = await fetchElement(target.href);\n    currentContent.replaceWith(newElement);\n    currentContent = newElement;\n}\n\nasync function fetchUrl(url, fetchLinkAppend) {\n    const response = await fetch(url + fetchLinkAppend);\n    if (!response.ok) {\n        throw new Error(optionsFromNeos.errorMsg);\n    }\n    const markup = await response.text();\n    url = completeUrl(url);\n    dispatchEvent({ url, lightbox: url + fetchLinkAppend, type: \"fetch\", action: \"open\" });\n    return markup;\n}\n\nfunction completeUrl(url) {\n    const reg = new RegExp(\"^(http|https)://\", \"i\");\n    if (reg.test(url)) {\n        return url;\n    }\n    return window.location.origin + (url.startsWith(\"/\") ? \"\" : \"/\") + url;\n}\n\nasync function fetchElement(url) {\n    toggleLoadingClass(true);\n    const markup = await fetchUrl(url, fetchLinkAppend).catch((error) => {\n        const message = error.message.replace('\"%s\"', url);\n        return `<p class=\"jonnitto-photoswipe-content__error\">${message}</p>`;\n    });\n\n    const template = document.createElement(\"template\");\n    template.innerHTML = markup;\n    const element = document.createElement(\"div\");\n    element.classList.add(wrappingClass);\n    element.append(...template.content.children);\n    toggleLoadingClass(false);\n    return element;\n}\n\nfunction getPswpContainer() {\n    if (pswpContainer) {\n        return pswpContainer;\n    }\n    pswpContainer = document.querySelector(\".pswp\");\n    return pswpContainer;\n}\n\nfunction toggleLoadingClass(show = true) {\n    getPswpContainer()?.classList.toggle(\"pswp--fetch-loading\", show);\n}\n\nfunction dispatchEvent(detail) {\n    const event = new CustomEvent(\"neosphotoswipe\", { detail });\n    document.dispatchEvent(event);\n}\n\nwindow.neosPhotoSwipe = window.neosPhotoSwipe || {};\nwindow.neosPhotoSwipe.fetch = {\n    init,\n    lightbox: init(),\n};\n"],
  "mappings": "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",
  "names": ["i18n", "optionsFromNeos", "wrappingClass", "fetchLinkAppend", "pswpContainer", "currentContent", "init", "options", "lightbox", "PhotoSwipeLightbox", "event", "container", "getPswpContainer", "pswpContentEventListener", "dispatchEvent", "content", "src", "element", "fetchElement", "target", "newElement", "fetchUrl", "url", "response", "markup", "completeUrl", "toggleLoadingClass", "error", "template", "show", "detail"]
}
